drop database if exists meeting_system;
create database meeting_system;
use meeting_system;
ALTER DATABASE meeting_system DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci; 

############################## create #########################################################
#### user ################
drop table if exists user;
create table user (
  user_id int(11) primary key auto_increment,
  user_name varchar(20) not null,
  password varchar(20) not null,
  avatar varchar(100) default 'default_avatar.jsp',
  sex enum('man', 'female') default NULL,
  user_role enum('ordinary', 'admin') not null default 'ordinary'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into user(user_name, password) values('罗晓镁', '123');
#insert into user(user_name, password) values('叶鹏霄', '123');
#select * from user;

#### meeting_room ################
drop table if exists meeting_room;
create table meeting_room (
  mr_id int(11) primary key auto_increment,
  mr_name varchar(20) not null,
  capacity int(2) not null default 0,
  occupation enum('yes', 'no') not null default 'no'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into meeting_room(mr_name) values('多媒体教室');
#select * from meeting_room;

#### meeting ################
drop table if exists meeting;
create table meeting (
  m_id int(11) primary key auto_increment,
  m_name varchar(20) not null,
  start_time Timestamp not null,
  end_time Timestamp not null,
  scheduled_time Timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  description varchar(200) not null,
  cancel enum('yes', 'no') not null default 'no',
  hold enum('yes', 'no') not null default 'no',
  mr_id int(11) not null,
  scheduler int(11) not null,
  constraint meeting_mrid foreign key(mr_id) references meeting_room(mr_id),
  constraint meeting_scheduler foreign key(scheduler) references user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into meeting(m_name, start_time, end_time, description, mr_id, scheduler) values('需求分析', '2018-03-25 12:00', '2018-03-25 13:00' , '谈论毕设', 1, 1);
#select * from meeting;

#### document ################
drop table if exists document;
create table document (
  d_id int(11) primary key auto_increment,
  d_name varchar(20) not null,
  path varchar(100) not null,
  m_id int(11) not null,
  constraint document_mid foreign key(m_id) references meeting(m_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into document(d_name, path, m_id) values('会议记录', 'path', 1);
#select * from document;

#### resource ################
drop table if exists resource;
create table resource (
  r_id int(11) primary key auto_increment,
  r_name varchar(20) not null,
  total int(2) not null default 0,
  remain int(2) not null default 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into resource(r_name, total, remain) values('投影仪', 10, 8);
#select * from resource;

#### message ################
drop table if exists message;
create table message (
  message_id int(11) primary key auto_increment,
  message_name varchar(20) not null,
  send_time Timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  content varchar(200) not null,
  scan enum('yes', 'no') not null default 'no',
  send_user_id int(11) not null,
  receive_user_id int(11) not null,
  constraint message_sendid foreign key(send_user_id) references user(user_id),
  constraint message_receiveid foreign key(receive_user_id) references user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into message(message_name, content, send_user_id, receive_user_id) values('会议通知', '待会召开会议', 1, 2);
#select * from message;

#### meeting_detail ################
drop table if exists meeting_detail;
create table meeting_detail (
  m_id int(11) not null,
  user_id int(11) not null,
  md_role enum('recorder', 'participant', 'master') not null default 'participant',
  will enum('yes', 'no', 'uncertain') not null default 'uncertain',
  PRIMARY KEY (m_id, user_id),
  constraint meetingdetail_mid foreign key(m_id) references meeting(m_id),
  constraint meetingdetail_userid foreign key(user_id) references user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into meeting_detail(m_id, user_id) values(1, 2);
#select * from meeting_detail;

#### meeting_resource ################
drop table if exists meeting_resource;
create table meeting_resource (
  m_id int(11) not null,
  r_id int(11) not null,
  number int(2) not null default 0,
  PRIMARY KEY (m_id, r_id),
  constraint meetingresource_mid foreign key(m_id) references meeting(m_id),
  constraint meetingresource_rid foreign key(r_id) references resource(r_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

#insert into meeting_resource(m_id, r_id, number) values(1, 1, 2);
#select * from meeting_resource;

############################## insert #########################################################
insert into user(user_name, password) values('罗晓镁', '123');
insert into user(user_name, password) values('叶鹏霄', '123');
select * from user;

insert into meeting_room(mr_name) values('多媒体教室');
select * from meeting_room;

insert into meeting(m_name, start_time, end_time, description, mr_id, scheduler) values('需求分析', '2018-03-25 12:00', '2018-03-25 13:00' , '谈论毕设', 1, 1);
select * from meeting;

insert into document(d_name, path, m_id) values('会议记录', 'path', 1);
select * from document;

insert into resource(r_name, total, remain) values('投影仪', 10, 8);
select * from resource;

insert into message(message_name, content, send_user_id, receive_user_id) values('会议通知', '待会召开会议', 1, 2);
select * from message;

insert into meeting_detail(m_id, user_id) values(1, 2);
select * from meeting_detail;

insert into meeting_resource(m_id, r_id, number) values(1, 1, 2);
select * from meeting_resource;






